var HyperMorph=(()=>{var q=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var J=(s,o)=>{for(var u in o)q(s,u,{get:o[u],enumerable:!0})},Q=(s,o,u,d)=>{if(o&&typeof o=="object"||typeof o=="function")for(let h of K(o))!Y.call(s,h)&&h!==u&&q(s,h,{get:()=>o[h],enumerable:!(d=G(o,h))||d.enumerable});return s};var X=s=>Q(q({},"__esModule",{value:!0}),s);var pe={};J(pe,{HyperMorph:()=>V,default:()=>he,defaults:()=>fe,morph:()=>de});var F={includeClasses:!0,includeAttributes:["href","src","name","type","role","aria-label","alt","title"],excludeAttributePrefixes:["data-morph-","data-hyper-","data-im-"],textHintLength:64,excludeIds:!0,maxPathDepth:4,landmarks:["HEADER","NAV","MAIN","ASIDE","FOOTER","SECTION","ARTICLE"],weights:{signature:100,pathSegment:10,textMatch:20,textMismatch:25,uniqueCandidate:50,positionPenalty:1},minConfidence:101};function Z(s){let o=5381;for(let u=0;u<s.length;u++)o=(o<<5)+o^s.charCodeAt(u);return Math.abs(o).toString(36)}function ee(s){if(s.classList&&s.classList.length>0)return Array.from(s.classList).sort().join(" ");let o=s.getAttribute?.("class");return o?o.split(/\s+/).filter(Boolean).sort().join(" "):""}function te(s,o){let u=[];for(let d of s.attributes||[]){let h=d.name;h==="id"||h==="class"||o.excludeAttributePrefixes.some(y=>h.startsWith(y))||o.includeAttributes.includes(h)&&u.push(`${h}=${d.value}`)}return u.sort().join("|")}function ne(s,o){return(s.textContent||"").replace(/\s+/g," ").trim().slice(0,o.textHintLength)}function re(s,o){let u=[s.tagName];return o.includeClasses&&u.push(ee(s)),u.push(te(s,o)),Z(u.join("|"))}function se(s){let o=s.tagName,u=1,d=s.previousElementSibling;for(;d;)d.tagName===o&&u++,d=d.previousElementSibling;return u}function ie(s,o){return s.id||s.getAttribute?.("role")?!0:o.landmarks.includes(s.tagName)}function ae(s){if(s.id)return`#${s.id}`;let o=s.getAttribute?.("role");return o?`@${o}`:s.tagName}function oe(s,o){let u=[],d=s;for(;d&&d.tagName&&u.length<o.maxPathDepth;){let h=`${d.tagName}:${se(d)}`;if(u.unshift(h),d!==s&&ie(d,o)){u.unshift(ae(d));break}d=d.parentElement}return u}function ue(s,o){let u=0,d=s.length-1,h=o.length-1;for(;d>=0&&h>=0&&s[d]===o[h];)u++,d--,h--;return u}function C(s,o,u){if(u.has(s))return u.get(s);let d={signature:re(s,o),path:oe(s,o),textHint:ne(s,o)};return u.set(s,d),d}function z(s,o,u,d){if(d.has(s))return d.get(s);let h=new Map,y=s.querySelectorAll("*"),H=0;for(let S of y){let I=C(S,o,u);I.domIndex=H++,h.has(I.signature)||h.set(I.signature,[]),h.get(I.signature).push(S)}return d.set(s,h),h}function ce(s,o,u){u.delete(s),o.delete(s);let d=s.querySelectorAll("*");for(let h of d)o.delete(h)}function $(s,o,u,d,h){let y=C(s,u,d),H=C(o,u,d),S=u.weights,I={},E=0;if(y.signature!==H.signature)return{score:0,breakdown:{rejected:"signature mismatch"}};E+=S.signature,I.signature=S.signature;let T=ue(y.path,H.path)*S.pathSegment;E+=T,I.path=T;let k=!0;if(y.textHint&&H.textHint?y.textHint===H.textHint?(E+=S.textMatch,I.text=S.textMatch):(E-=S.textMismatch,I.text=-S.textMismatch,k=!1):y.textHint!==H.textHint&&(E-=S.textMismatch,I.text=-S.textMismatch,k=!1),h.candidateCount===1&&k&&(E+=S.uniqueCandidate,I.unique=S.uniqueCandidate),typeof y.domIndex=="number"&&typeof H.domIndex=="number"){let N=Math.abs(y.domIndex-H.domIndex),R=Math.min(N*S.positionPenalty,20);E-=R,I.drift=-R}return{score:E,breakdown:I}}function D(s,o,u,d,h){if(u.excludeIds&&s.id)return null;let y=z(o,u,d,h),H=C(s,u,d);if(typeof H.domIndex!="number"){let k=0,N=s.previousElementSibling;for(;N;)k++,N=N.previousElementSibling;H.domIndex=k}let S=y.get(H.signature)||[],I=u.excludeIds?S.filter(k=>!k.id):S;if(I.length===0)return null;let E=null,x=0,T=null;for(let k of I){let{score:N,breakdown:R}=$(s,k,u,d,{candidateCount:I.length});N>x&&(x=N,E=k,T=R)}return x<u.minConfidence?null:{element:E,confidence:x,breakdown:T}}function W(s,o,u,d,h){let y=o.querySelectorAll("*"),H=z(s,u,d,h),S=0;for(let T of y){let k=C(T,u,d);k.domIndex=S++}let I=[];for(let T of y){if(u.excludeIds&&T.id)continue;let k=C(T,u,d),N=H.get(k.signature)||[],R=u.excludeIds?N.filter(B=>!B.id):N;for(let B of R){let{score:l,breakdown:A}=$(T,B,u,d,{candidateCount:R.length});l>=u.minConfidence&&I.push({newEl:T,oldEl:B,score:l,breakdown:A})}}I.sort((T,k)=>k.score-T.score);let E=new Map,x=new Set;for(let{newEl:T,oldEl:k}of I)E.has(T)||x.has(k)||(E.set(T,k),x.add(k));return E}function P(s,o,u,d){let h=C(s,u,d),y=C(o,u,d),{score:H,breakdown:S}=$(s,o,u,d,{candidateCount:1});return{matches:H>=u.minConfidence,score:H,breakdown:S,newMeta:{signature:h.signature,path:h.path,textHint:h.textHint},oldMeta:{signature:y.signature,path:y.path,textHint:y.textHint}}}function U(s={}){let o={...F,...s,weights:{...F.weights,...s.weights}},u=new WeakMap,d=new WeakMap;return{findMatch:(h,y)=>D(h,y,o,u,d),computeMatches:(h,y)=>W(h,y,o,u,d),explain:(h,y)=>P(h,y,o,u),invalidate:h=>ce(h,u,d),session:()=>{let h=new WeakMap,y=new WeakMap;return{findMatch:(H,S)=>D(H,S,o,h,y),computeMatches:(H,S)=>W(H,S,o,h,y),explain:(H,S)=>P(H,S,o,h)}},getConfig:()=>({...o})}}var le=U(),V=(function(){"use strict";let s=()=>{};function o(l){if(!(l instanceof Element))return!1;if(l.hasAttribute("save-ignore"))return!0;if(l.tagName==="LINK"||l.tagName==="SCRIPT"){let A=l.getAttribute("src")||l.getAttribute("href")||"";if(A.startsWith("chrome-extension://")||A.startsWith("moz-extension://")||A.startsWith("safari-web-extension://"))return!0}return!1}function u(l,A){if(A!=="smart")return l.outerHTML;let p=l.getAttribute("src"),v=l.getAttribute("type")||"text/javascript";if(p)try{let b=new URL(p,window.location.href);return`ext:${v}:${b.origin}${b.pathname}`}catch{return`ext:${v}:${p}`}else{let b=l.textContent.trim(),m=5381;for(let r=0;r<b.length;r++)m=(m<<5)+m^b.charCodeAt(r);return`inline:${v}:${Math.abs(m).toString(36)}`}}let d={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:s,afterNodeAdded:s,beforeNodeMorphed:s,afterNodeMorphed:s,beforeNodeRemoved:s,afterNodeRemoved:s,beforeAttributeUpdated:s},head:{style:"merge",shouldPreserve:l=>l.getAttribute("im-preserve")==="true",shouldReAppend:l=>l.getAttribute("im-re-append")==="true",shouldRemove:s,afterHeadMorphed:s},scripts:{handle:!1,matchMode:"outerHTML",shouldPreserve:l=>l.getAttribute("im-preserve")==="true",shouldReAppend:l=>l.getAttribute("im-re-append")==="true",shouldRemove:s,afterScriptsHandled:s},restoreFocus:!0},h={computeMatches(l,A){let{computeMatches:p}=le.session();return p(l,A)}};function y(l,A,p={}){l=R(l);let v=B(A),b=N(l,v,p),m=b.scripts.matchMode,r=new Set(Array.from(l.querySelectorAll("script")).map(t=>u(t,m))),c=S(b,()=>x(b,l,v,t=>t.morphStyle==="innerHTML"?(I(t,l,v),Array.from(l.childNodes)):H(t,l,v)));b.pantry.remove();let e=k(l,r,b);return e.length>0?c instanceof Promise?c.then(t=>Promise.all(e).then(()=>t)):Promise.all(e).then(()=>c):c}function H(l,A,p){let v=B(A);return I(l,v,p,A,A.nextSibling),Array.from(v.childNodes)}function S(l,A){if(!l.config.restoreFocus)return A();let p=document.activeElement;if(!(p instanceof HTMLInputElement||p instanceof HTMLTextAreaElement))return A();let{id:v,selectionStart:b,selectionEnd:m}=p,r=A();return v&&v!==document.activeElement?.getAttribute("id")&&(p=l.target.querySelector(`[id="${v}"]`),p?.focus()),p&&!p.selectionEnd&&m!=null&&p.setSelectionRange(b,m),r}let I=(function(){function l(e,t,i,n=null,a=null){t instanceof HTMLTemplateElement&&i instanceof HTMLTemplateElement&&(t=t.content,i=i.content),n||=t.firstChild;for(let f of i.childNodes){if(o(f))continue;if(n&&n!=a){let M=p(e,f,n,a);if(M){M!==n&&b(e,n,M),E(M,f,e),n=M.nextSibling;continue}}if(f instanceof Element){let M=f.getAttribute("id");if(e.persistentIds.has(M)){let L=m(t,M,n,e);E(L,f,e),n=L.nextSibling;continue}if(!e.idMap.has(f)){let L=e.hyperMatches.get(f);if(L&&!e.idMap.has(L)){c(t,L,n),E(L,f,e),n=L.nextSibling;continue}}}let g=A(t,f,n,e);g&&(n=g.nextSibling)}for(;n&&n!=a;){let f=n;n=n.nextSibling,o(f)||v(e,f)}}function A(e,t,i,n){if(n.callbacks.beforeNodeAdded(t)===!1)return null;if(n.idMap.has(t)){let a=document.createElement(t.tagName);return e.insertBefore(a,i),E(a,t,n),n.callbacks.afterNodeAdded(a),a}else{let a=document.importNode(t,!0);return e.insertBefore(a,i),n.callbacks.afterNodeAdded(a),a}}let p=(function(){function e(n,a,f,g){let M=a instanceof Element&&!n.idMap.has(a)?n.hyperMatches.get(a):null,L=null,O=a.nextSibling,j=0,w=f;for(;w&&w!=g;){if(i(w,a)){if(t(n,w,a)||w===M&&!n.idMap.has(w))return w;if(L===null){let _=w instanceof Element&&n.hyperMatchedOldElements.has(w);!n.idMap.has(w)&&!_&&(L=w)}}if(L===null&&O&&i(w,O)&&(j++,O=O.nextSibling,j>=2&&(L=void 0)),n.activeElementAndParents.includes(w))break;w=w.nextSibling}return L||null}function t(n,a,f){let g=n.idMap.get(a),M=n.idMap.get(f);if(!M||!g)return!1;for(let L of g)if(M.has(L))return!0;return!1}function i(n,a){let f=n,g=a;return f.nodeType===g.nodeType&&f.tagName===g.tagName&&(!f.getAttribute?.("id")||f.getAttribute?.("id")===g.getAttribute?.("id"))}return e})();function v(e,t){let i=t instanceof Element&&e.hyperMatchedOldElements.has(t)&&!e.idMap.has(t);if(e.idMap.has(t)||i)c(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;t.parentNode?.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function b(e,t,i){let n=t;for(;n&&n!==i;){let a=n;n=n.nextSibling,o(a)||v(e,a)}return n}function m(e,t,i,n){let a=n.target.getAttribute?.("id")===t&&n.target||n.target.querySelector(`[id="${t}"]`)||n.pantry.querySelector(`[id="${t}"]`);return r(a,n),c(e,a,i),a}function r(e,t){let i=e.getAttribute("id");for(;e=e.parentNode;){let n=t.idMap.get(e);n&&(n.delete(i),n.size||t.idMap.delete(e))}}function c(e,t,i){if(e.moveBefore)try{e.moveBefore(t,i)}catch{e.insertBefore(t,i)}else e.insertBefore(t,i)}return l})(),E=(function(){function l(r,c,e){return e.ignoreActive&&r===document.activeElement?null:(e.callbacks.beforeNodeMorphed(r,c)===!1||(r instanceof HTMLHeadElement&&e.head.ignore||(r instanceof HTMLHeadElement&&e.head.style!=="morph"?T(r,c,e):(A(r,c,e),m(r,e)||I(e,r,c))),e.callbacks.afterNodeMorphed(r,c)),r)}function A(r,c,e){let t=c.nodeType;if(t===1){let i=r,n=c,a=i.attributes,f=n.attributes;for(let g of f)b(g.name,i,"update",e)||i.getAttribute(g.name)!==g.value&&i.setAttribute(g.name,g.value);for(let g=a.length-1;0<=g;g--){let M=a[g];if(M&&!n.hasAttribute(M.name)){if(b(M.name,i,"remove",e))continue;i.removeAttribute(M.name)}}m(i,e)||p(i,n,e)}(t===8||t===3)&&r.nodeValue!==c.nodeValue&&(r.nodeValue=c.nodeValue)}function p(r,c,e){if(r instanceof HTMLInputElement&&c instanceof HTMLInputElement&&c.type!=="file"){let t=c.value,i=r.value;v(r,c,"checked",e),v(r,c,"disabled",e),c.hasAttribute("value")?i!==t&&(b("value",r,"update",e)||(r.setAttribute("value",t),r.value=t)):b("value",r,"remove",e)||(r.value="",r.removeAttribute("value"))}else if(r instanceof HTMLOptionElement&&c instanceof HTMLOptionElement)v(r,c,"selected",e);else if(r instanceof HTMLTextAreaElement&&c instanceof HTMLTextAreaElement){let t=c.value,i=r.value;if(b("value",r,"update",e))return;t!==i&&(r.value=t),r.firstChild&&r.firstChild.nodeValue!==t&&(r.firstChild.nodeValue=t)}}function v(r,c,e,t){let i=c[e],n=r[e];if(i!==n){let a=b(e,r,"update",t);a||(r[e]=c[e]),i?a||r.setAttribute(e,""):b(e,r,"remove",t)||r.removeAttribute(e)}}function b(r,c,e,t){return r==="value"&&t.ignoreActiveValue&&c===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(r,c,e)===!1}function m(r,c){return!!c.ignoreActiveValue&&r===document.activeElement&&r!==document.body}return l})();function x(l,A,p,v){if(l.head.block){let b=A.querySelector("head"),m=p.querySelector("head");if(b&&m){let r=T(b,m,l);return Promise.all(r).then(()=>{let c=Object.assign(l,{head:{block:!1,ignore:!0}});return v(c)})}}return v(l)}function T(l,A,p){let v=[],b=[],m=[],r=[],c=p.scripts.matchMode,e=n=>n.tagName==="SCRIPT"?u(n,c):n.outerHTML,t=new Map;for(let n of A.children)t.set(e(n),n);for(let n of l.children){let a=e(n),f=t.has(a),g=p.head.shouldReAppend(n),M=p.head.shouldPreserve(n);f||M?g?b.push(n):(t.delete(a),m.push(n)):p.head.style==="append"?g&&(b.push(n),r.push(n)):p.head.shouldRemove(n)!==!1&&b.push(n)}r.push(...t.values());let i=[];for(let n of r){let a=document.createRange().createContextualFragment(n.outerHTML).firstChild;if(p.callbacks.beforeNodeAdded(a)!==!1){if("href"in a&&a.href||"src"in a&&a.src){let f,g=new Promise(function(M){f=M});a.addEventListener("load",function(){f()}),i.push(g)}l.appendChild(a),p.callbacks.afterNodeAdded(a),v.push(a)}}for(let n of b)p.callbacks.beforeNodeRemoved(n)!==!1&&(l.removeChild(n),p.callbacks.afterNodeRemoved(n));return p.head.afterHeadMorphed(l,{added:v,kept:m,removed:b}),i}function k(l,A,p){if(!p.scripts.handle)return[];let v=[],b=[],m=[],r=[],c=p.scripts.matchMode,e=Array.from(l.querySelectorAll("script"));for(let i of e){let n=u(i,c),a=A.has(n),f=p.scripts.shouldPreserve(i),g=p.scripts.shouldReAppend(i);a||f?g?(b.push(i),r.push(i)):m.push(i):r.push(i)}for(let i of A){let n=e.some(a=>a.outerHTML===i)}let t=[];for(let i of r){if(p.callbacks.beforeNodeAdded(i)===!1)continue;let n=document.createRange().createContextualFragment(i.outerHTML).firstChild;if(n.src){let a,f=new Promise(function(g){a=g});n.addEventListener("load",function(){a()}),n.addEventListener("error",function(){a()}),t.push(f)}i.replaceWith(n),p.callbacks.afterNodeAdded(n),v.push(n)}return p.scripts.afterScriptsHandled(l,{added:v,kept:m,removed:b}),t}let N=(function(){function l(e,t,i){let{persistentIds:n,idMap:a}=r(e,t),f=h.computeMatches(e,t),g=new Set;for(let O of f.values())g.add(O);let M=A(i),L=M.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(L))throw`Do not understand how to morph style ${L}`;return{target:e,newContent:t,config:M,morphStyle:L,ignoreActive:M.ignoreActive,ignoreActiveValue:M.ignoreActiveValue,restoreFocus:M.restoreFocus,idMap:a,persistentIds:n,hyperMatches:f,hyperMatchedOldElements:g,pantry:p(),activeElementAndParents:v(e),callbacks:M.callbacks,head:M.head,scripts:M.scripts}}function A(e){let t=Object.assign({},d);return Object.assign(t,e),t.callbacks=Object.assign({},d.callbacks,e.callbacks),t.head=Object.assign({},d.head,e.head),t.scripts=Object.assign({},d.scripts,e.scripts),t}function p(){let e=document.createElement("div");return e.hidden=!0,document.body.insertAdjacentElement("afterend",e),e}function v(e){let t=[],i=document.activeElement;if(i?.tagName!=="BODY"&&e.contains(i))for(;i&&(t.push(i),i!==e);)i=i.parentElement;return t}function b(e){let t=Array.from(e.querySelectorAll("[id]"));return e.getAttribute?.("id")&&t.push(e),t}function m(e,t,i,n){for(let a of n){let f=a.getAttribute("id");if(t.has(f)){let g=a;for(;g;){let M=e.get(g);if(M==null&&(M=new Set,e.set(g,M)),M.add(f),g===i)break;g=g.parentElement}}}}function r(e,t){let i=b(e),n=b(t),a=c(i,n),f=new Map;m(f,a,e,i);let g=t.__hyperMorphRoot||t;return m(f,a,g,n),{persistentIds:a,idMap:f}}function c(e,t){let i=new Set,n=new Map;for(let{id:f,tagName:g}of e)n.has(f)?i.add(f):n.set(f,g);let a=new Set;for(let{id:f,tagName:g}of t)a.has(f)?i.add(f):n.get(f)===g&&a.add(f);for(let f of i)a.delete(f);return a}return l})(),{normalizeElement:R,normalizeParent:B}=(function(){let l=new WeakSet;function A(m){return m instanceof Document?m.documentElement:m}function p(m){if(m==null)return document.createElement("div");if(typeof m=="string")return p(b(m));if(l.has(m))return m;if(m instanceof Node){if(m.parentNode)return new v(m);{let r=document.createElement("div");return r.append(m),r}}else{let r=document.createElement("div");for(let c of[...m])r.append(c);return r}}class v{constructor(r){this.originalNode=r,this.realParentNode=r.parentNode,this.previousSibling=r.previousSibling,this.nextSibling=r.nextSibling}get childNodes(){let r=[],c=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;c&&c!=this.nextSibling;)r.push(c),c=c.nextSibling;return r}querySelectorAll(r){return this.childNodes.reduce((c,e)=>{if(e instanceof Element){e.matches(r)&&c.push(e);let t=e.querySelectorAll(r);for(let i=0;i<t.length;i++)c.push(t[i])}return c},[])}insertBefore(r,c){return this.realParentNode.insertBefore(r,c)}moveBefore(r,c){return this.realParentNode.moveBefore(r,c)}get __hyperMorphRoot(){return this.originalNode}}function b(m){let r=new DOMParser,c=m.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(c.match(/<\/html>/)||c.match(/<\/head>/)||c.match(/<\/body>/)){let e=r.parseFromString(m,"text/html");if(c.match(/<\/html>/))return l.add(e),e;{let t=e.firstChild;return t&&l.add(t),t}}else{let t=r.parseFromString("<body><template>"+m+"</template></body>","text/html").body.querySelector("template").content;return l.add(t),t}}return{normalizeElement:A,normalizeParent:p}})();return{morph:y,defaults:d}})();var de=V.morph,fe=V.defaults,he=V;return X(pe);})();

// Convenience morph wrapper with data-id support
var morph = function(oldEl, newEl, options = {}) {
    return HyperMorph.morph(oldEl, newEl, {
        key: (el) => el.getAttribute('data-id') || el.id,
        ...options
    });
};

// Auto-export to window unless suppressed by loader
if (!window.__hyperclayNoAutoExport) {
  window.hyperclay = window.hyperclay || {};
  window.hyperclay.HyperMorph = HyperMorph;
  window.hyperclay.morph = morph;
  window.HyperMorph = HyperMorph;
  window.morph = morph;
  window.h = window.hyperclay;
}

export { HyperMorph, morph };
export default HyperMorph;
