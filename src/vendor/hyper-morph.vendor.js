var HyperMorph=(()=>{var V=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var J=(s,u)=>{for(var a in u)V(s,a,{get:u[a],enumerable:!0})},K=(s,u,a,d)=>{if(u&&typeof u=="object"||typeof u=="function")for(let h of G(u))!Y.call(s,h)&&h!==a&&V(s,h,{get:()=>u[h],enumerable:!(d=U(u,h))||d.enumerable});return s};var Q=s=>K(V({},"__esModule",{value:!0}),s);var he={};J(he,{HyperMorph:()=>C,default:()=>fe,defaults:()=>de,morph:()=>ce});var j={includeClasses:!0,includeAttributes:["href","src","name","type","role","aria-label","alt","title"],excludeAttributePrefixes:["data-morph-","data-hyper-","data-im-"],textHintLength:64,excludeIds:!0,maxPathDepth:4,landmarks:["HEADER","NAV","MAIN","ASIDE","FOOTER","SECTION","ARTICLE"],weights:{signature:100,pathSegment:10,textMatch:20,textMismatch:25,uniqueCandidate:50,positionPenalty:1},minConfidence:101};function X(s){let u=5381;for(let a=0;a<s.length;a++)u=(u<<5)+u^s.charCodeAt(a);return Math.abs(u).toString(36)}function Z(s){if(s.classList&&s.classList.length>0)return Array.from(s.classList).sort().join(" ");let u=s.getAttribute?.("class");return u?u.split(/\s+/).filter(Boolean).sort().join(" "):""}function ee(s,u){let a=[];for(let d of s.attributes||[]){let h=d.name;h==="id"||h==="class"||u.excludeAttributePrefixes.some(A=>h.startsWith(A))||u.includeAttributes.includes(h)&&a.push(`${h}=${d.value}`)}return a.sort().join("|")}function te(s,u){return(s.textContent||"").replace(/\s+/g," ").trim().slice(0,u.textHintLength)}function ne(s,u){let a=[s.tagName];return u.includeClasses&&a.push(Z(s)),a.push(ee(s,u)),X(a.join("|"))}function re(s){let u=s.tagName,a=1,d=s.previousElementSibling;for(;d;)d.tagName===u&&a++,d=d.previousElementSibling;return a}function se(s,u){return s.id||s.getAttribute?.("role")?!0:u.landmarks.includes(s.tagName)}function ie(s){if(s.id)return`#${s.id}`;let u=s.getAttribute?.("role");return u?`@${u}`:s.tagName}function ae(s,u){let a=[],d=s;for(;d&&d.tagName&&a.length<u.maxPathDepth;){let h=`${d.tagName}:${re(d)}`;if(a.unshift(h),d!==s&&se(d,u)){a.unshift(ie(d));break}d=d.parentElement}return a}function oe(s,u){let a=0,d=s.length-1,h=u.length-1;for(;d>=0&&h>=0&&s[d]===u[h];)a++,d--,h--;return a}function B(s,u,a){if(a.has(s))return a.get(s);let d={signature:ne(s,u),path:ae(s,u),textHint:te(s,u)};return a.set(s,d),d}function P(s,u,a,d){if(d.has(s))return d.get(s);let h=new Map,A=s.querySelectorAll("*"),H=0;for(let M of A){let k=B(M,u,a);k.domIndex=H++,h.has(k.signature)||h.set(k.signature,[]),h.get(k.signature).push(M)}return d.set(s,h),h}function ue(s,u,a){a.delete(s),u.delete(s);let d=s.querySelectorAll("*");for(let h of d)u.delete(h)}function q(s,u,a,d,h){let A=B(s,a,d),H=B(u,a,d),M=a.weights,k={},L=0;if(A.signature!==H.signature)return{score:0,breakdown:{rejected:"signature mismatch"}};L+=M.signature,k.signature=M.signature;let I=oe(A.path,H.path)*M.pathSegment;L+=I,k.path=I;let E=!0;if(A.textHint&&H.textHint?A.textHint===H.textHint?(L+=M.textMatch,k.text=M.textMatch):(L-=M.textMismatch,k.text=-M.textMismatch,E=!1):A.textHint!==H.textHint&&(L-=M.textMismatch,k.text=-M.textMismatch,E=!1),h.candidateCount===1&&E&&(L+=M.uniqueCandidate,k.unique=M.uniqueCandidate),typeof A.domIndex=="number"&&typeof H.domIndex=="number"){let N=Math.abs(A.domIndex-H.domIndex),R=Math.min(N*M.positionPenalty,20);L-=R,k.drift=-R}return{score:L,breakdown:k}}function D(s,u,a,d,h){if(a.excludeIds&&s.id)return null;let A=P(u,a,d,h),H=B(s,a,d);if(typeof H.domIndex!="number"){let E=0,N=s.previousElementSibling;for(;N;)E++,N=N.previousElementSibling;H.domIndex=E}let M=A.get(H.signature)||[],k=a.excludeIds?M.filter(E=>!E.id):M;if(k.length===0)return null;let L=null,x=0,I=null;for(let E of k){let{score:N,breakdown:R}=q(s,E,a,d,{candidateCount:k.length});N>x&&(x=N,L=E,I=R)}return x<a.minConfidence?null:{element:L,confidence:x,breakdown:I}}function $(s,u,a,d,h){let A=u.querySelectorAll("*"),H=P(s,a,d,h),M=0;for(let I of A){let E=B(I,a,d);E.domIndex=M++}let k=[];for(let I of A){if(a.excludeIds&&I.id)continue;let E=B(I,a,d),N=H.get(E.signature)||[],R=a.excludeIds?N.filter(c=>!c.id):N;for(let c of R){let{score:S,breakdown:p}=q(I,c,a,d,{candidateCount:R.length});S>=a.minConfidence&&k.push({newEl:I,oldEl:c,score:S,breakdown:p})}}k.sort((I,E)=>E.score-I.score);let L=new Map,x=new Set;for(let{newEl:I,oldEl:E}of k)L.has(I)||x.has(E)||(L.set(I,E),x.add(E));return L}function W(s,u,a,d){let h=B(s,a,d),A=B(u,a,d),{score:H,breakdown:M}=q(s,u,a,d,{candidateCount:1});return{matches:H>=a.minConfidence,score:H,breakdown:M,newMeta:{signature:h.signature,path:h.path,textHint:h.textHint},oldMeta:{signature:A.signature,path:A.path,textHint:A.textHint}}}function z(s={}){let u={...j,...s,weights:{...j.weights,...s.weights}},a=new WeakMap,d=new WeakMap;return{findMatch:(h,A)=>D(h,A,u,a,d),computeMatches:(h,A)=>$(h,A,u,a,d),explain:(h,A)=>W(h,A,u,a),invalidate:h=>ue(h,a,d),session:()=>{let h=new WeakMap,A=new WeakMap;return{findMatch:(H,M)=>D(H,M,u,h,A),computeMatches:(H,M)=>$(H,M,u,h,A),explain:(H,M)=>W(H,M,u,h)}},getConfig:()=>({...u})}}var le=z(),C=(function(){"use strict";let s=()=>{};function u(c){return c instanceof Element&&c.hasAttribute("save-ignore")}let a={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:s,afterNodeAdded:s,beforeNodeMorphed:s,afterNodeMorphed:s,beforeNodeRemoved:s,afterNodeRemoved:s,beforeAttributeUpdated:s},head:{style:"merge",shouldPreserve:c=>c.getAttribute("im-preserve")==="true",shouldReAppend:c=>c.getAttribute("im-re-append")==="true",shouldRemove:s,afterHeadMorphed:s},scripts:{handle:!1,shouldPreserve:c=>c.getAttribute("im-preserve")==="true",shouldReAppend:c=>c.getAttribute("im-re-append")==="true",shouldRemove:s,afterScriptsHandled:s},restoreFocus:!0},d={computeMatches(c,S){let{computeMatches:p}=le.session();return p(c,S)}};function h(c,S,p={}){c=N(c);let y=R(S),b=E(c,y,p),m=new Set(Array.from(c.querySelectorAll("script")).map(e=>e.outerHTML)),n=H(b,()=>L(b,c,y,e=>e.morphStyle==="innerHTML"?(M(e,c,y),Array.from(c.childNodes)):A(e,c,y)));b.pantry.remove();let o=I(c,m,b);return o.length>0?n instanceof Promise?n.then(e=>Promise.all(o).then(()=>e)):Promise.all(o).then(()=>n):n}function A(c,S,p){let y=R(S);return M(c,y,p,S,S.nextSibling),Array.from(y.childNodes)}function H(c,S){if(!c.config.restoreFocus)return S();let p=document.activeElement;if(!(p instanceof HTMLInputElement||p instanceof HTMLTextAreaElement))return S();let{id:y,selectionStart:b,selectionEnd:m}=p,n=S();return y&&y!==document.activeElement?.getAttribute("id")&&(p=c.target.querySelector(`[id="${y}"]`),p?.focus()),p&&!p.selectionEnd&&m!=null&&p.setSelectionRange(b,m),n}let M=(function(){function c(e,t,i,r=null,l=null){t instanceof HTMLTemplateElement&&i instanceof HTMLTemplateElement&&(t=t.content,i=i.content),r||=t.firstChild;for(let f of i.childNodes){if(u(f))continue;if(r&&r!=l){let v=p(e,f,r,l);if(v){v!==r&&b(e,r,v),k(v,f,e),r=v.nextSibling;continue}}if(f instanceof Element){let v=f.getAttribute("id");if(e.persistentIds.has(v)){let T=m(t,v,r,e);k(T,f,e),r=T.nextSibling;continue}if(!e.idMap.has(f)){let T=e.hyperMatches.get(f);if(T&&!e.idMap.has(T)){o(t,T,r),k(T,f,e),r=T.nextSibling;continue}}}let g=S(t,f,r,e);g&&(r=g.nextSibling)}for(;r&&r!=l;){let f=r;r=r.nextSibling,u(f)||y(e,f)}}function S(e,t,i,r){if(r.callbacks.beforeNodeAdded(t)===!1)return null;if(r.idMap.has(t)){let l=document.createElement(t.tagName);return e.insertBefore(l,i),k(l,t,r),r.callbacks.afterNodeAdded(l),l}else{let l=document.importNode(t,!0);return e.insertBefore(l,i),r.callbacks.afterNodeAdded(l),l}}let p=(function(){function e(r,l,f,g){let v=l instanceof Element&&!r.idMap.has(l)?r.hyperMatches.get(l):null,T=null,O=l.nextSibling,F=0,w=f;for(;w&&w!=g;){if(i(w,l)){if(t(r,w,l)||w===v&&!r.idMap.has(w))return w;if(T===null){let _=w instanceof Element&&r.hyperMatchedOldElements.has(w);!r.idMap.has(w)&&!_&&(T=w)}}if(T===null&&O&&i(w,O)&&(F++,O=O.nextSibling,F>=2&&(T=void 0)),r.activeElementAndParents.includes(w))break;w=w.nextSibling}return T||null}function t(r,l,f){let g=r.idMap.get(l),v=r.idMap.get(f);if(!v||!g)return!1;for(let T of g)if(v.has(T))return!0;return!1}function i(r,l){let f=r,g=l;return f.nodeType===g.nodeType&&f.tagName===g.tagName&&(!f.getAttribute?.("id")||f.getAttribute?.("id")===g.getAttribute?.("id"))}return e})();function y(e,t){let i=t instanceof Element&&e.hyperMatchedOldElements.has(t)&&!e.idMap.has(t);if(e.idMap.has(t)||i)o(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;t.parentNode?.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function b(e,t,i){let r=t;for(;r&&r!==i;){let l=r;r=r.nextSibling,u(l)||y(e,l)}return r}function m(e,t,i,r){let l=r.target.getAttribute?.("id")===t&&r.target||r.target.querySelector(`[id="${t}"]`)||r.pantry.querySelector(`[id="${t}"]`);return n(l,r),o(e,l,i),l}function n(e,t){let i=e.getAttribute("id");for(;e=e.parentNode;){let r=t.idMap.get(e);r&&(r.delete(i),r.size||t.idMap.delete(e))}}function o(e,t,i){if(e.moveBefore)try{e.moveBefore(t,i)}catch{e.insertBefore(t,i)}else e.insertBefore(t,i)}return c})(),k=(function(){function c(n,o,e){return e.ignoreActive&&n===document.activeElement?null:(e.callbacks.beforeNodeMorphed(n,o)===!1||(n instanceof HTMLHeadElement&&e.head.ignore||(n instanceof HTMLHeadElement&&e.head.style!=="morph"?x(n,o,e):(S(n,o,e),m(n,e)||M(e,n,o))),e.callbacks.afterNodeMorphed(n,o)),n)}function S(n,o,e){let t=o.nodeType;if(t===1){let i=n,r=o,l=i.attributes,f=r.attributes;for(let g of f)b(g.name,i,"update",e)||i.getAttribute(g.name)!==g.value&&i.setAttribute(g.name,g.value);for(let g=l.length-1;0<=g;g--){let v=l[g];if(v&&!r.hasAttribute(v.name)){if(b(v.name,i,"remove",e))continue;i.removeAttribute(v.name)}}m(i,e)||p(i,r,e)}(t===8||t===3)&&n.nodeValue!==o.nodeValue&&(n.nodeValue=o.nodeValue)}function p(n,o,e){if(n instanceof HTMLInputElement&&o instanceof HTMLInputElement&&o.type!=="file"){let t=o.value,i=n.value;y(n,o,"checked",e),y(n,o,"disabled",e),o.hasAttribute("value")?i!==t&&(b("value",n,"update",e)||(n.setAttribute("value",t),n.value=t)):b("value",n,"remove",e)||(n.value="",n.removeAttribute("value"))}else if(n instanceof HTMLOptionElement&&o instanceof HTMLOptionElement)y(n,o,"selected",e);else if(n instanceof HTMLTextAreaElement&&o instanceof HTMLTextAreaElement){let t=o.value,i=n.value;if(b("value",n,"update",e))return;t!==i&&(n.value=t),n.firstChild&&n.firstChild.nodeValue!==t&&(n.firstChild.nodeValue=t)}}function y(n,o,e,t){let i=o[e],r=n[e];if(i!==r){let l=b(e,n,"update",t);l||(n[e]=o[e]),i?l||n.setAttribute(e,""):b(e,n,"remove",t)||n.removeAttribute(e)}}function b(n,o,e,t){return n==="value"&&t.ignoreActiveValue&&o===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(n,o,e)===!1}function m(n,o){return!!o.ignoreActiveValue&&n===document.activeElement&&n!==document.body}return c})();function L(c,S,p,y){if(c.head.block){let b=S.querySelector("head"),m=p.querySelector("head");if(b&&m){let n=x(b,m,c);return Promise.all(n).then(()=>{let o=Object.assign(c,{head:{block:!1,ignore:!0}});return y(o)})}}return y(c)}function x(c,S,p){let y=[],b=[],m=[],n=[],o=new Map;for(let t of S.children)o.set(t.outerHTML,t);for(let t of c.children){let i=o.has(t.outerHTML),r=p.head.shouldReAppend(t),l=p.head.shouldPreserve(t);i||l?r?b.push(t):(o.delete(t.outerHTML),m.push(t)):p.head.style==="append"?r&&(b.push(t),n.push(t)):p.head.shouldRemove(t)!==!1&&b.push(t)}n.push(...o.values());let e=[];for(let t of n){let i=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(p.callbacks.beforeNodeAdded(i)!==!1){if("href"in i&&i.href||"src"in i&&i.src){let r,l=new Promise(function(f){r=f});i.addEventListener("load",function(){r()}),e.push(l)}c.appendChild(i),p.callbacks.afterNodeAdded(i),y.push(i)}}for(let t of b)p.callbacks.beforeNodeRemoved(t)!==!1&&(c.removeChild(t),p.callbacks.afterNodeRemoved(t));return p.head.afterHeadMorphed(c,{added:y,kept:m,removed:b}),e}function I(c,S,p){if(!p.scripts.handle)return[];let y=[],b=[],m=[],n=[],o=Array.from(c.querySelectorAll("script"));for(let t of o){let i=t.outerHTML,r=S.has(i),l=p.scripts.shouldPreserve(t),f=p.scripts.shouldReAppend(t);r||l?f?(b.push(t),n.push(t)):m.push(t):n.push(t)}for(let t of S){let i=o.some(r=>r.outerHTML===t)}let e=[];for(let t of n){if(p.callbacks.beforeNodeAdded(t)===!1)continue;let i=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(i.src){let r,l=new Promise(function(f){r=f});i.addEventListener("load",function(){r()}),i.addEventListener("error",function(){r()}),e.push(l)}t.replaceWith(i),p.callbacks.afterNodeAdded(i),y.push(i)}return p.scripts.afterScriptsHandled(c,{added:y,kept:m,removed:b}),e}let E=(function(){function c(e,t,i){let{persistentIds:r,idMap:l}=n(e,t),f=d.computeMatches(e,t),g=new Set;for(let O of f.values())g.add(O);let v=S(i),T=v.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(T))throw`Do not understand how to morph style ${T}`;return{target:e,newContent:t,config:v,morphStyle:T,ignoreActive:v.ignoreActive,ignoreActiveValue:v.ignoreActiveValue,restoreFocus:v.restoreFocus,idMap:l,persistentIds:r,hyperMatches:f,hyperMatchedOldElements:g,pantry:p(),activeElementAndParents:y(e),callbacks:v.callbacks,head:v.head,scripts:v.scripts}}function S(e){let t=Object.assign({},a);return Object.assign(t,e),t.callbacks=Object.assign({},a.callbacks,e.callbacks),t.head=Object.assign({},a.head,e.head),t.scripts=Object.assign({},a.scripts,e.scripts),t}function p(){let e=document.createElement("div");return e.hidden=!0,document.body.insertAdjacentElement("afterend",e),e}function y(e){let t=[],i=document.activeElement;if(i?.tagName!=="BODY"&&e.contains(i))for(;i&&(t.push(i),i!==e);)i=i.parentElement;return t}function b(e){let t=Array.from(e.querySelectorAll("[id]"));return e.getAttribute?.("id")&&t.push(e),t}function m(e,t,i,r){for(let l of r){let f=l.getAttribute("id");if(t.has(f)){let g=l;for(;g;){let v=e.get(g);if(v==null&&(v=new Set,e.set(g,v)),v.add(f),g===i)break;g=g.parentElement}}}}function n(e,t){let i=b(e),r=b(t),l=o(i,r),f=new Map;m(f,l,e,i);let g=t.__hyperMorphRoot||t;return m(f,l,g,r),{persistentIds:l,idMap:f}}function o(e,t){let i=new Set,r=new Map;for(let{id:f,tagName:g}of e)r.has(f)?i.add(f):r.set(f,g);let l=new Set;for(let{id:f,tagName:g}of t)l.has(f)?i.add(f):r.get(f)===g&&l.add(f);for(let f of i)l.delete(f);return l}return c})(),{normalizeElement:N,normalizeParent:R}=(function(){let c=new WeakSet;function S(m){return m instanceof Document?m.documentElement:m}function p(m){if(m==null)return document.createElement("div");if(typeof m=="string")return p(b(m));if(c.has(m))return m;if(m instanceof Node){if(m.parentNode)return new y(m);{let n=document.createElement("div");return n.append(m),n}}else{let n=document.createElement("div");for(let o of[...m])n.append(o);return n}}class y{constructor(n){this.originalNode=n,this.realParentNode=n.parentNode,this.previousSibling=n.previousSibling,this.nextSibling=n.nextSibling}get childNodes(){let n=[],o=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;o&&o!=this.nextSibling;)n.push(o),o=o.nextSibling;return n}querySelectorAll(n){return this.childNodes.reduce((o,e)=>{if(e instanceof Element){e.matches(n)&&o.push(e);let t=e.querySelectorAll(n);for(let i=0;i<t.length;i++)o.push(t[i])}return o},[])}insertBefore(n,o){return this.realParentNode.insertBefore(n,o)}moveBefore(n,o){return this.realParentNode.moveBefore(n,o)}get __hyperMorphRoot(){return this.originalNode}}function b(m){let n=new DOMParser,o=m.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(o.match(/<\/html>/)||o.match(/<\/head>/)||o.match(/<\/body>/)){let e=n.parseFromString(m,"text/html");if(o.match(/<\/html>/))return c.add(e),e;{let t=e.firstChild;return t&&c.add(t),t}}else{let t=n.parseFromString("<body><template>"+m+"</template></body>","text/html").body.querySelector("template").content;return c.add(t),t}}return{normalizeElement:S,normalizeParent:p}})();return{morph:h,defaults:a}})();var ce=C.morph,de=C.defaults,fe=C;return Q(he);})();

// Convenience morph wrapper with data-id support
var morph = function(oldEl, newEl, options = {}) {
    return HyperMorph.morph(oldEl, newEl, {
        key: (el) => el.getAttribute('data-id') || el.id,
        ...options
    });
};

// Auto-export to window unless suppressed by loader
if (!window.__hyperclayNoAutoExport) {
  window.hyperclay = window.hyperclay || {};
  window.hyperclay.HyperMorph = HyperMorph;
  window.hyperclay.morph = morph;
  window.HyperMorph = HyperMorph;
  window.morph = morph;
  window.h = window.hyperclay;
}

export { HyperMorph, morph };
export default HyperMorph;
