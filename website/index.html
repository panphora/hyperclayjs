<!DOCTYPE html>
<html lang="en" savestatus="saved" editmode="true">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperclayJS - Better DOM API</title>
    <meta name="description" content="A single HTML file is all you need to build a web app. Hyperclay hosts these HTML files so you can create personal, malleable software easily.">
    <meta property="og:url" content="https://hyperclayjs.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="HyperclayJS - Better DOM API">
    <meta property="og:description" content="A single HTML file is all you need to build a web app. Hyperclay hosts these HTML files so you can create personal, malleable software easily.">
    <meta property="og:image" content="https://hyperclayjs.com/assets/open-graph.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="hyperclayjs.com">
    <meta property="twitter:url" content="https://hyperclayjs.com/">
    <meta name="twitter:title" content="HyperclayJS - Better DOM API">
    <meta name="twitter:description" content="A single HTML file is all you need to build a web app. Hyperclay hosts these HTML files so you can create personal, malleable software easily.">
    <meta name="twitter:image" content="https://hyperclayjs.com/assets/open-graph.jpg">
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <style>
        @font-face {
            font-family: 'Berkeley Mono';
            src: url('./assets/BerkeleyMonoVariable-Regular.woff2') format('woff2');
            font-weight: 100 900;
            font-style: normal;
            font-display: swap;
        }

        :root {
            --primary-blue: #3E43EF;
            --shadow-blue: #F1F2FE;
            --light-blue: #8A8FEF;
            --white: #FFFFFF;
            --gray: #6B7280;
            --green: #00A676;
            --red: #E63946;
            --yellow: #E69500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Berkeley Mono', monospace;
            background-color: white;
            color: var(--primary-blue);
            padding: 1.5rem;
            line-height: 1.5;
            text-wrap: pretty;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 2rem;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary-blue);
            margin-bottom: 0.25rem;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--light-blue);
        }

        .intro-bullets {
            margin-top: 0.75rem;
            padding-left: 1.25rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .intro-bullets li {
            margin-bottom: 0.25rem;
        }

        .intro-link {
            color: var(--gray);
            text-decoration: underline;
        }

        .intro-link:hover {
            text-decoration: none;
        }

        .intro-section {
            margin-top: 1.5rem;
            padding: 1.25rem;
            border: 2px solid var(--primary-blue);
            background: var(--shadow-blue);
        }

        .intro-section h2 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.75rem;
        }

        .intro-section p {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .intro-section p:last-child {
            margin-bottom: 0;
        }

        .intro-section strong {
            color: var(--primary-blue);
        }

        .feature-list {
            list-style: none;
            margin: 0.75rem 0;
            padding-left: 1.25rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .feature-list li {
            margin-bottom: 0.25rem;
        }

        .feature-list li::before {
            content: "•";
            color: var(--primary-blue);
            display: inline-block;
            width: 1rem;
            margin-left: -1rem;
        }

        .nav-links {
            margin-left: auto;
            display: flex;
            gap: 1rem;
        }

        .nav-link {
            font-weight: bold;
            color: var(--primary-blue);
            text-decoration: none;
            border: 2px solid var(--primary-blue);
            padding: 0.5rem 1rem;
            background: white;
            box-shadow: 4px 4px 0 var(--shadow-blue);
            white-space: nowrap;
        }

        .nav-link:hover {
            background: var(--shadow-blue);
        }

        .nav-link-icon {
            padding: 0.5rem;
            display: flex;
            align-items: center;
        }

        .nav-link-icon svg {
            display: block;
        }

        .demo-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .demo-card {
            flex: 1 1 320px;
            max-width: calc(33.333% - 0.67rem);
        }

        .category-label {
            flex: 1 1 100%;
        }

        @media (max-width: 1000px) {
            .demo-card { max-width: calc(50% - 0.5rem); }
        }

        @media (max-width: 640px) {
            .demo-card { max-width: 100%; }
            h1 { font-size: 2rem; }
            .header-row {
                flex-direction: column-reverse;
                align-items: flex-end;
            }
            .header-row h1 {
                align-self: flex-start;
            }
        }

        .demo-card {
            border: 2px solid var(--primary-blue);
            padding: 1rem;
            background: white;
        }

        .demo-card h3 {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--primary-blue);
        }

        .demo-card .desc {
            font-size: 0.75rem;
            color: var(--gray);
            margin-bottom: 0.75rem;
        }

        .demo-card pre {
            background: var(--shadow-blue);
            padding: 0.5rem;
            font-size: 0.7rem;
            overflow-x: auto;
            margin-bottom: 0.75rem;
            border-left: 3px solid var(--primary-blue);
            max-width: 100%;
        }

        .demo-card code {
            font-family: inherit;
        }

        .demo-area {
            padding: 0.5rem;
            border: 1px dashed var(--light-blue);
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        button {
            font-family: inherit;
            font-size: 0.75rem;
            padding: 0.4rem 0.75rem;
            border: 2px solid var(--primary-blue);
            background: white;
            color: var(--primary-blue);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.15s;
        }

        button:hover {
            background: var(--shadow-blue);
        }

        button:active:not(:disabled) {
            transform: translate(1px, 1px);
        }

        button:disabled, input:disabled, select:disabled,
        [inert-contenteditable] {
            opacity: 0.5;
            cursor: not-allowed;
        }

        input:read-only:not([sum]):not([type="radio"]):not([type="checkbox"]):not([type="file"]) {
            opacity: 0.5;
            cursor: not-allowed;
        }

        input[sum] {
            border-color: black;
        }

        input, textarea, select {
            font-family: inherit;
            font-size: 0.75rem;
            padding: 0.4rem;
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            box-shadow: 2px 2px 0 var(--shadow-blue);
        }

        textarea {
            resize: none;
            min-height: 40px;
        }

        .sortable-list {
            list-style: none;
            width: 100%;
        }

        .sortable-list li {
            padding: 0.4rem 0.6rem;
            background: var(--shadow-blue);
            margin-bottom: 0.25rem;
            cursor: move;
            font-size: 0.75rem;
            border: 1px solid var(--light-blue);
        }

        .output {
            font-size: 0.7rem;
            color: var(--gray);
            background: var(--shadow-blue);
            padding: 0.25rem 0.5rem;
            width: 100%;
        }

        .category-label {
            grid-column: 1 / -1;
            font-size: 0.8rem;
            font-weight: 700;
            color: #E85D04;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 1rem 0 0.25rem;
            border-bottom: 2px solid #E85D04;
            margin-top: 0.5rem;
        }

        .category-label:first-of-type {
            margin-top: 0;
        }

        .clickaway-box {
            background: var(--shadow-blue);
            padding: 0.5rem;
            text-align: center;
            font-size: 0.75rem;
            cursor: pointer;
            width: 100%;
        }

        .clone-item {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
            margin: 0.15rem;
        }

        .counter-display {
            font-size: 1.2rem;
            font-weight: 700;
            min-width: 3rem;
            text-align: center;
        }

        .visibility-box {
            padding: 0.5rem;
            background: var(--green);
            color: white;
            font-size: 0.7rem;
            text-align: center;
        }

        .attr-display {
            font-size: 0.65rem;
            color: var(--gray);
            word-break: break-all;
        }

        .mini-editor {
            border: 1px solid var(--light-blue);
            background: white;
            padding: 0.5rem;
            min-height: 50px;
            font-size: 0.75rem;
        }

        .mini-editor:focus {
            outline: none;
            box-shadow: 2px 2px 0 var(--shadow-blue);
        }

        .badge {
            display: inline-block;
            border: 1px solid var(--light-blue);
            padding: 0.2rem 0.4rem;
            font-size: 0.7rem;
            background: white;
        }

        .flex-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* New styles for demos */
        .hidden { display: none !important; }
        .muted { opacity: 0.4; border-style: dashed !important; }
                .menu-box {
            padding: 0.5rem;
            background: var(--shadow-blue);
            font-size: 0.7rem;
            text-align: center;
            border: 1px solid var(--light-blue);
        }

        .sync-card {
            border: 1px solid var(--light-blue);
            padding: 0.5rem;
            background: white;
            font-size: 0.75rem;
            min-height: 60px;
        }

        .sync-card:focus {
            outline: none;
            box-shadow: 2px 2px 0 var(--shadow-blue);
        }

        .filter-card {
            padding: 0.5rem;
            background: var(--shadow-blue);
            font-size: 0.7rem;
            text-align: center;
            border: 1px solid var(--light-blue);
            transition: opacity 0.2s, border-style 0.2s;
        }

        .morph-box {
            padding: 0.5rem;
            background: var(--shadow-blue);
            font-size: 0.75rem;
            text-align: center;
            border: 1px solid var(--light-blue);
            min-width: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-row">
                <h1>HyperclayJS</h1>
                <div class="nav-links">
                    <a href="docs.html" class="nav-link">Docs</a>
                    <a href="https://github.com/panphora/hyperclayjs" class="nav-link nav-link-icon" target="_blank" rel="noopener" title="GitHub">
                        <svg width="20" height="20" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"/></svg>
                    </a>
                    <a href="config.html" class="nav-link">Use HyperclayJS &rarr;</a>
                </div>
            </div>
            <p class="subtitle">A Better DOM API</p>
            <ul class="intro-bullets">
                <li>The DOM API is incomplete. These modules patch the gaps.</li>
                <li>Pair with <a href="https://hyperclay.com" class="intro-link">Hyperclay</a> to unlock HTML files that edit themselves.</li>
            </ul>

            <div class="intro-section" style="background: #FEF3E6; border-color: #E85D04;">
                <h2 style="color: #E85D04;">What is HyperclayJS?</h2>
                <p>
                    HyperclayJS is the JavaScript library that powers single-file HTML apps. It gives your HTML files the ability to overwrite themselves, toggles between admin and viewer modes, and blurs the line between document and application.
                </p>
            </div>

            <div class="intro-section" style="margin-top: 0.75rem;">
                <h2>What is Hyperclay?</h2>
                <p>
                    <strong>Hyperclay</strong> is a unique system that lets you directly shape HTML files and have changes persist live on the web.
                </p>
                <p><strong>Features:</strong></p>
                <ul class="feature-list">
                    <li>Turn HTML files into apps</li>
                    <li>Share access, attach custom domains, allow signups</li>
                    <li>Create a simple CMS by turning HTML into a JSON API</li>
                    <li>Sync apps from <a href="https://hyperclay.com/hyperclay-local" style="color: inherit; text-decoration: none;">Hyperclay Local</a> directly online</li>
                </ul>
                <p>
                    Build admin controls that are automatically stripped before saving and restored when you return, so regular users only ever see a clean static page.
                </p>
                <p>
                    <strong>One HTML file, full application.</strong>
                </p>
            </div>
        </div>

        <div class="demo-grid">

            <!-- ========== SECTION 1: SAVE (CORE) ========== -->
            <div class="category-label">Save (core)</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Hyperclay pages update themselves. The save state is tracked via a <code>savestatus</code> attribute on the <code>&lt;html&gt;</code> element.</p>

            <!-- savePage() -->
            <div class="demo-card" id="save-page">
                <h3>savePage()</h3>
                <p class="desc">Persist page's HTML to a hyperclay server</p>
                <pre><code>hyperclay.savePage(callback);</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <button onclick="testSavePage()">Call savePage()</button>
                    <span class="output" id="save-page-log">Click to trigger save</span>
                </div>
            </div>

            <!-- save-system -->
            <div class="demo-card" id="save-system">
                <h3>save-system</h3>
                <p class="desc">Track changes via savestatus attribute</p>
                <pre><code>&lt;html savestatus="saved"&gt;
&lt;!-- saved | saving | dirty | error --&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="mini-editor" contenteditable id="save-editor">Type here to mark dirty</div>
                    <span class="output" id="save-system-log">savestatus: saved</span>
                </div>
            </div>

            <!-- autosave -->
            <div class="demo-card" id="autosave">
                <h3>autosave</h3>
                <p class="desc">Auto-save on DOM mutations</p>
                <pre><code>// Automatic - debounces saves
// after DOM changes</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="mini-editor" contenteditable id="autosave-editor">Edit me, pause, watch auto-save</div>
                    <span class="output" id="autosave-log">Waiting for edits...</span>
                </div>
            </div>

            <!-- save-toast -->
            <div class="demo-card" id="save-toast">
                <h3>save-toast</h3>
                <p class="desc">Toast on save events</p>
                <pre><code>// Shows toast on
// hyperclay:save-* events</code></pre>
                <div class="demo-area">
                    <button onclick="dispatchSaveEvent('saved')">Dispatch saved</button>
                    <button onclick="dispatchSaveEvent('error')">Dispatch error</button>
                </div>
            </div>

            <!-- onaftersave -->
            <div class="demo-card" id="onaftersave">
                <h3>[onaftersave]</h3>
                <p class="desc">Run JS after save events</p>
                <pre><code>&lt;div onaftersave="this.textContent =
  event.detail.status"&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <button onclick="dispatchSaveEvent('saved')">Trigger save event</button>
                    <span class="output" onaftersave="this.textContent = 'event.detail.status = ' + event.detail.status">Waiting for save event...</span>
                </div>
            </div>

            <!-- ========== SECTION 2: EDIT MODE (CORE) ========== -->
            <div class="category-label">Edit Mode (core)</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Edit mode is a state defined by an <code>editmode</code> attribute on the <code>&lt;html&gt;</code> element. When true, admin controls are usable/visible; when false, they are disabled/hidden.</p>

            <!-- toggleEditMode -->
            <div class="demo-card" id="toggle-edit-mode">
                <h3>toggleEditMode()</h3>
                <p class="desc">Switch edit mode on/off (affects other demos)</p>
                <pre><code>hyperclay.toggleEditMode();
hyperclay.isEditMode;</code></pre>
                <div class="demo-area">
                    <button onclick="toggleEditModeDemo()">Toggle edit mode</button>
                    <span class="output" id="edit-mode-status">editmode: true</span>
                </div>
            </div>

            <!-- edit-mode-contenteditable -->
            <div class="demo-card" id="edit-mode-contenteditable">
                <h3>[edit-mode-contenteditable]</h3>
                <p class="desc">Only editable in edit mode, otherwise readonly</p>
                <pre><code>&lt;div edit-mode-contenteditable&gt;
  Editable in edit mode
&lt;/div&gt;</code></pre>
                <div class="demo-area">
                    <div class="mini-editor" edit-mode-contenteditable contenteditable style="width: 100%;">Only editable in edit mode, otherwise readonly</div>
                </div>
            </div>

            <!-- edit-mode-input -->
            <div class="demo-card" id="edit-mode-input">
                <h3>[edit-mode-input]</h3>
                <p class="desc">Inputs/selects editable only in edit mode</p>
                <pre><code>&lt;input edit-mode-input&gt;
&lt;select edit-mode-input&gt;</code></pre>
                <div class="demo-area flex-row">
                    <input edit-mode-input value="Admin only" style="flex: 1;">
                    <select edit-mode-input>
                        <option>Option A</option>
                        <option>Option B</option>
                    </select>
                </div>
            </div>

            <!-- edit-mode-onclick -->
            <div class="demo-card" id="edit-mode-onclick">
                <h3>[edit-mode-onclick]</h3>
                <p class="desc">onclick handlers active only in edit mode</p>
                <pre><code>&lt;button edit-mode-onclick
  onclick="alert('Admin!')"&gt;</code></pre>
                <div class="demo-area">
                    <button edit-mode-onclick edit-mode-input onclick="alert('Admin action triggered!')">Admin Action</button>
                    <span class="output">Only works in edit mode</span>
                </div>
            </div>

            <!-- edit-mode-resource -->
            <div class="demo-card" id="edit-mode-resource">
                <h3>[edit-mode-resource]</h3>
                <p class="desc">Scripts/styles active only in edit mode</p>
                <pre><code>&lt;style edit-mode-resource&gt;
  .edit-outline { outline: 2px dashed blue; }
&lt;/style&gt;</code></pre>
                <div class="demo-area">
                    <style edit-mode-resource type="text/css">.edit-outline { outline: 2px dashed #E85D04; border: none; }</style>
                    <div class="edit-outline badge">Dashed outline in edit mode</div>
                </div>
            </div>

            <!-- persist -->
            <div class="demo-card" id="persist">
                <h3>[persist]</h3>
                <p class="desc">Persist form values to DOM attributes</p>
                <pre><code>&lt;input persist&gt;
&lt;select persist&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="flex-row">
                        <input persist id="persist-input" placeholder="Type..." oninput="updatePersistDisplay()" style="flex: 1;">
                        <label style="font-size: 0.7rem; display: flex; align-items: center; gap: 0.25rem;">
                            <input type="radio" persist name="persist-radio" value="A" onchange="updatePersistDisplay()"> A
                        </label>
                        <label style="font-size: 0.7rem; display: flex; align-items: center; gap: 0.25rem;">
                            <input type="radio" persist name="persist-radio" value="B" onchange="updatePersistDisplay()"> B
                        </label>
                        <select persist id="persist-select" onchange="updatePersistDisplay()">
                            <option>One</option>
                            <option>Two</option>
                        </select>
                    </div>
                    <span class="output" id="persist-log">Values will appear here</span>
                </div>
            </div>

            <!-- ========== SECTION 3: DOM HELPERS ========== -->
            <div class="category-label">DOM Helpers</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Properties added to all elements that patch two gaps in the native DOM: traversing intuitively through the natural hierarchy, and getting/setting values in one short command.</p>

            <!-- el.val -->
            <div class="demo-card" id="el-val">
                <h3>el.val</h3>
                <p class="desc">Get/set attribute values on nearest matching element</p>
                <pre><code>&lt;input a oninput="this.val.sum =
  Number(this.val.a) + Number(this.val.b)"&gt;</code></pre>
                <div class="demo-area flex-row">
                    <input type="number" a value="0" oninput="this.val.sum = Number(this.val.a) + Number(this.val.b)" style="width: 60px;">
                    <span>+</span>
                    <input type="number" b value="0" oninput="this.val.sum = Number(this.val.a) + Number(this.val.b)" style="width: 60px;">
                    <span>=</span>
                    <input sum readonly value="0" style="width: 60px; border-color: #006B4D; background: #E6F5F0; color: #006B4D;">
                </div>
            </div>

            <!-- el.text -->
            <div class="demo-card" id="el-text">
                <h3>el.text</h3>
                <p class="desc">Get/set innerText on nearest matching element</p>
                <pre><code>&lt;button onclick="this.text.counter--"&gt;-&lt;/button&gt;
&lt;div counter&gt;0&lt;/div&gt;</code></pre>
                <div class="demo-area flex-row" style="justify-content: center;">
                    <button onclick="this.text.counter--">-</button>
                    <div counter class="counter-display">0</div>
                    <button onclick="this.text.counter++">+</button>
                </div>
            </div>

            <!-- el.exec -->
            <div class="demo-card" id="el-exec">
                <h3>el.exec</h3>
                <p class="desc">Execute code stored in an attribute</p>
                <pre><code>&lt;div confirm-delete="consent('Delete?',
  () =&gt; this.remove())"&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div id="exec-demo-container" confirm-delete="execDeleteDemo(this)" style="display: flex; gap: 0.5rem; align-items: center;">
                        <span class="badge">Deletable Item</span>
                        <button onclick="this.exec['confirm-delete']()">Delete</button>
                    </div>
                    <span class="output" id="exec-log">Click delete to trigger consent</span>
                </div>
            </div>

            <!-- el.nearest -->
            <div class="demo-card" id="el-nearest">
                <h3>el.nearest</h3>
                <p class="desc">Nearest matching element (searches siblings, ancestors, and their descendants)</p>
                <pre><code>&lt;span paintable&gt;Item&lt;/span&gt;
&lt;button onclick="this.nearest.paintable
  .style.background = randomColor()"&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <span paintable class="badge">Paintable Item</span>
                        <button onclick="this.nearest.paintable.style.background = randomColor(); this.nearest.paintable.style.color = '#fff'">Paint</button>
                    </div>
                    <span class="output" id="nearest-log">Click paint to color the sibling badge</span>
                </div>
            </div>

            <!-- ========== SECTION 4: OPTION VISIBILITY ========== -->
            <div class="category-label">Option Visibility</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Show or hide elements based on the value of an attribute on an ancestor element. Uses the <code>option:</code> prefix.</p>

            <!-- option:savestatus -->
            <div class="demo-card" id="option-savestatus">
                <h3>option:savestatus</h3>
                <p class="desc">Show elements based on hyperclay save state</p>
                <pre><code>&lt;span option:savestatus="saved"&gt;
  ✓ Saved
&lt;/span&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="flex-row" style="margin-bottom: 0.5rem;">
                        <button onclick="document.documentElement.setAttribute('savestatus', 'saved')">Set saved</button>
                        <button onclick="document.documentElement.setAttribute('savestatus', 'saving')">Set saving</button>
                        <button onclick="document.documentElement.setAttribute('savestatus', 'dirty')">Set dirty</button>
                    </div>
                    <div class="flex-row">
                        <span class="badge" option:savestatus="saved" style="background: var(--green); color: white; border: 2px solid #006B4D;">✓ Saved</span>
                        <span class="badge" option:savestatus="saving" style="background: var(--yellow); color: white; border: 2px solid #A66D00;">Saving...</span>
                        <span class="badge" option:savestatus="dirty" style="background: var(--red); color: white; border: 2px solid #A62833;">Unsaved</span>
                    </div>
                </div>
            </div>

            <!-- option:editmode -->
            <div class="demo-card" id="option-editmode">
                <h3>option:editmode</h3>
                <p class="desc">Show elements only in hyperclay edit mode</p>
                <pre><code>&lt;button option:editmode="true"&gt;
  Edit Tools
&lt;/button&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="flex-row" style="margin-bottom: 0.5rem;">
                        <button onclick="setEditMode(true)">Edit mode ON</button>
                        <button onclick="setEditMode(false)">Edit mode OFF</button>
                    </div>
                    <div class="flex-row">
                        <span class="badge" option:editmode="true" style="background: var(--primary-blue); color: white; border: 2px solid #1e1b4b;">Edit Tools</span>
                        <span class="badge" option:editmode="false" style="background: var(--gray); color: white; border: 2px solid #334155;">View Only</span>
                    </div>
                </div>
            </div>

            <!-- option:status (custom) -->
            <div class="demo-card" id="option-status">
                <h3>option:status (custom)</h3>
                <p class="desc">Show elements based on any custom attribute</p>
                <pre><code>&lt;div status="pending"&gt;
  &lt;span option:status="completed"&gt;</code></pre>
                <div class="demo-area" id="status-demo" status="pending" style="flex-direction: column; align-items: stretch;">
                    <div class="flex-row" style="margin-bottom: 0.5rem;">
                        <button onclick="this.closest('[status]').setAttribute('status', 'completed')">Mark Completed</button>
                        <button onclick="this.closest('[status]').setAttribute('status', 'pending')">Mark Pending</button>
                    </div>
                    <div class="flex-row">
                        <span class="badge" option:status="pending" style="background: var(--yellow); color: white; border: 2px solid #A66D00;">⏳ Pending</span>
                        <span class="badge" option:status="completed" style="background: var(--green); color: white; border: 2px solid #006B4D;">✓ Completed</span>
                    </div>
                </div>
            </div>

            <!-- ========== SECTION 5: EVENT ATTRIBUTES ========== -->
            <div class="category-label">Event Attributes</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Custom event attributes that extend the native <code>on*</code> pattern to handle rendering, cloning, click-away, and drag-and-drop sorting.</p>

            <!-- onrender -->
            <div class="demo-card" id="onrender">
                <h3>[onrender]</h3>
                <p class="desc">Execute JS when element renders</p>
                <pre><code>&lt;span onrender="this.textContent =
  new Date().toLocaleTimeString()"&gt;</code></pre>
                <div class="demo-area">
                    <span class="output" onrender="this.textContent = 'Rendered at ' + new Date().toLocaleTimeString()"></span>
                </div>
            </div>

            <!-- onclone -->
            <div class="demo-card" id="onclone">
                <h3>[onclone]</h3>
                <p class="desc">Execute JS when element is cloned</p>
                <pre><code>&lt;div onclone="this.style.background =
  randomColor()"&gt;</code></pre>
                <div class="demo-area" id="clone-area">
                    <button onclick="cloneItem()">Clone</button>
                    <span id="clone-template" onclone="this.style.background = randomColor(); this.style.color = '#fff'" class="clone-item" style="display:none;">Item</span>
                </div>
            </div>

            <!-- onclickaway -->
            <div class="demo-card" id="onclickaway">
                <h3>[onclickaway]</h3>
                <p class="desc">Trigger code when clicking outside element</p>
                <pre><code>&lt;div onclick="reset"
     onclickaway="trigger"&gt;</code></pre>
                <div class="demo-area">
                    <div class="clickaway-box"
                         onclick="this.textContent = 'Click outside me'"
                         onclickaway="this.textContent = 'Clicked outside!'">Click outside me</div>
                </div>
            </div>

            <!-- sortable -->
            <div class="demo-card" id="sortable">
                <h3>[sortable]</h3>
                <p class="desc">Drag-and-drop reordering with onsorted callback</p>
                <pre><code>&lt;ul sortable onsorted="..."&gt;
  &lt;li&gt;Item&lt;/li&gt;
&lt;/ul&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <ul class="sortable-list" sortable onsorting="document.getElementById('sortable-log').textContent = 'Dragging: ' + evt.dragged.textContent" onsorted="document.getElementById('sortable-log').textContent = 'Sorted: ' + evt.item.textContent">
                        <li>Drag me (1)</li>
                        <li>Drag me (2)</li>
                        <li>Drag me (3)</li>
                    </ul>
                    <span class="output" id="sortable-log">Drag items to reorder</span>
                </div>
            </div>

            <!-- ========== SECTION 6: ALL() ========== -->
            <div class="category-label">All()</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">The tersest way to work with multiple elements. <code>All.x</code> selects by attribute or class, native array methods transform them, and any DOM method applies to all at once.</p>

            <!-- Close All Menus -->
            <div class="demo-card" id="all-close-menus">
                <h3>Close Menus</h3>
                <p class="desc">Select all elements by attribute and modify them</p>
                <pre><code>All.menu.classList.add('hidden');</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="flex-row" style="margin-bottom: 0.5rem;">
                        <button onclick="All.menu.forEach(m => m.classList.add('hidden'))">Close All</button>
                        <button onclick="All.menu.forEach(m => m.classList.remove('hidden'))">Open All</button>
                    </div>
                    <div class="flex-row">
                        <div menu class="menu-box">Menu 1</div>
                        <div menu class="menu-box">Menu 2</div>
                        <div menu class="menu-box">Menu 3</div>
                    </div>
                </div>
            </div>

            <!-- Live Sync -->
            <div class="demo-card" id="all-live-sync">
                <h3>Live Sync</h3>
                <p class="desc">Sync content across elements with same identifier</p>
                <pre><code>All.sync_card.forEach(c =>
  c.val.project_name === this.val.project_name
  && c.innerHTML !== this.innerHTML
  && (c.innerHTML = this.innerHTML))</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch; gap: 0.5rem;">
                    <div sync_card project_name="alpha" class="sync-card" contenteditable onmutation="All.sync_card.forEach(c => c !== this && c.val.project_name === this.val.project_name && c.innerHTML !== this.innerHTML && (c.innerHTML = this.innerHTML))">Edit me - I sync with below</div>
                    <div sync_card project_name="alpha" class="sync-card" contenteditable onmutation="All.sync_card.forEach(c => c !== this && c.val.project_name === this.val.project_name && c.innerHTML !== this.innerHTML && (c.innerHTML = this.innerHTML))">Edit me - I sync with above</div>
                </div>
            </div>

            <!-- Filter by Category -->
            <div class="demo-card" id="all-filter">
                <h3>Filter by Category</h3>
                <p class="desc">Filter elements with a dropdown</p>
                <pre><code>All.card.forEach(c =>
  c.classList.toggle('muted', ...)
)</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <select onchange="filterByCategory(this.value)" style="margin-bottom: 0.5rem;">
                        <option value="">All</option>
                        <option value="work">Work</option>
                        <option value="personal">Personal</option>
                    </select>
                    <div class="flex-row">
                        <div filter-card category="work" class="filter-card">Work</div>
                        <div filter-card category="personal" class="filter-card">Personal</div>
                        <div filter-card category="work" class="filter-card">Work</div>
                    </div>
                </div>
            </div>

            <!-- ========== SECTION 7: MUTATION ========== -->
            <div class="category-label">Mutation</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Run code when the DOM changes, scoped to a single element or the entire page.</p>

            <!-- onmutation -->
            <div class="demo-card" id="onmutation">
                <h3>[onmutation]</h3>
                <p class="desc">Trigger code when this element or its children change</p>
                <pre><code>&lt;div onmutation="console.log('changed')"&gt;
  &lt;span contenteditable&gt;Edit&lt;/span&gt;
&lt;/div&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div onmutation="document.getElementById('onmutation-log').textContent = 'Mutation detected @ ' + new Date().toLocaleTimeString()">
                        <div class="mini-editor" contenteditable style="width: 100%;">Edit me to trigger mutation</div>
                    </div>
                    <span class="output" id="onmutation-log">Edit the text above</span>
                </div>
            </div>

            <!-- onglobalmutation -->
            <div class="demo-card" id="onglobalmutation">
                <h3>[onglobalmutation]</h3>
                <p class="desc">Trigger code when any element on the page changes</p>
                <pre><code>&lt;span onglobalmutation="this.textContent =
  All('li').length"&gt;0&lt;/span&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;" id="globalmutation-zone">
                    <button onclick="addGlobalMutationItem()">Add item</button>
                    <ul id="globalmutation-list" style="list-style: none; display: flex; gap: 0.25rem; flex-wrap: wrap; margin-top: 0.25rem;"></ul>
                    <span class="output" onglobalmutation="this.textContent = 'Total items: ' + document.querySelectorAll('#globalmutation-list li').length">Total items: 0</span>
                </div>
            </div>

            <!-- Mutation.onAddElement -->
            <div class="demo-card" id="mutation-api">
                <h3>Mutation.onAddElement</h3>
                <p class="desc">Programmatic observer for added elements</p>
                <pre><code>Mutation.onAddElement({
  selectorFilter: '.item'
}, changes => ...);</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;" id="mutation-zone">
                    <button onclick="addMutationBlocks()">Add 8 elements</button>
                    <div id="mutation-items" style="display: flex; gap: 0.25rem; flex-wrap: wrap; margin-top: 0.25rem;"></div>
                    <span class="output" id="mutation-log">Click to add watched elements</span>
                </div>
            </div>

            <!-- ========== SECTION 8: UTILITIES ========== -->
            <div class="category-label">Utilities</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Standalone helpers for common tasks: DOM morphing, clipboard, slugs, query params, and style injection.</p>

            <!-- Idiomorph -->
            <div class="demo-card" id="idiomorph">
                <h3>Idiomorph</h3>
                <p class="desc">Morph DOM preserving state/focus</p>
                <pre><code>Idiomorph.morph(el, newHtml);</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <div class="flex-row" id="morph-container">
                        <div class="morph-box">A</div>
                        <div class="morph-box">A</div>
                        <div class="morph-box" id="morph-target">A</div>
                    </div>
                    <button onclick="morphDemo()" style="margin-top: 0.5rem;">Morph 3rd box</button>
                </div>
            </div>

            <!-- insertStyleTag -->
            <div class="demo-card" id="style-injection">
                <h3>insertStyleTag()</h3>
                <p class="desc">Inject CSS stylesheet dynamically</p>
                <pre><code>insertStyleTag('./test-style.css');</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <button onclick="hyperclay.insertStyleTag?.('./test-style.css'); document.getElementById('style-log').textContent = 'CSS injected!'">Inject CSS</button>
                    <span class="output test-style-injected" id="style-log">Click to inject</span>
                </div>
            </div>

            <!-- slugify -->
            <div class="demo-card" id="slugify">
                <h3>slugify()</h3>
                <p class="desc">URL-friendly slug generator</p>
                <pre><code>slugify('Hello World!')
// "hello-world"</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <input placeholder="Type to slugify..." oninput="document.getElementById('slug-out').textContent = slugify(this.value)" style="width: 100%;">
                    <span class="output" id="slug-out"></span>
                </div>
            </div>

            <!-- copyToClipboard -->
            <div class="demo-card" id="clipboard">
                <h3>copyToClipboard()</h3>
                <p class="desc">Copy text to clipboard</p>
                <pre><code>copyToClipboard('Hello!');</code></pre>
                <div class="demo-area flex-row">
                    <input id="copy-input" value="Copy this text!" style="flex: 1;">
                    <button onclick="hyperclay.copyToClipboard(document.getElementById('copy-input').value); toast('Copied!', 'success')">Copy</button>
                </div>
            </div>

            <!-- query -->
            <div class="demo-card" id="query">
                <h3>query</h3>
                <p class="desc">Parse URL search params</p>
                <pre><code>// ?name=dev
query.name // "dev"</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <button onclick="location.search = '?demo=true&count=42'">Add params to current page</button>
                    <span class="output" id="query-out">(no params)</span>
                </div>
            </div>

            <!-- ========== SECTION 9: UI COMPONENTS ========== -->
            <div class="category-label">UI Components</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">The modals and prompts that should ship with the browser: ask for input, confirm an action, show a message.</p>

            <!-- theModal -->
            <div class="demo-card" id="themodal">
                <h3>theModal</h3>
                <p class="desc">Parent module for ask/tell/consent/snippet</p>
                <pre><code>themodal.html = '&lt;h2&gt;Custom&lt;/h2&gt;';
themodal.open();</code></pre>
                <div class="demo-area">
                    <button onclick="openCustomModal()">Open Modal</button>
                </div>
            </div>

            <!-- ask() -->
            <div class="demo-card" id="ask">
                <h3>ask()</h3>
                <p class="desc">Edit attributes inline with ask() and el.nearest</p>
                <pre><code>ask('URL:', res => {
  this.nearest.link.href = res;
})</code></pre>
                <div class="demo-area" style="justify-content: space-between;">
                    <a link href="https://example.com" target="_blank">example.com</a>
                    <button onclick="ask('New URL:', res => { this.nearest.link.href = res; this.nearest.link.textContent = res.replace(/^https?:\/\//, ''); }, this.nearest.link.href)">Edit Link</button>
                </div>
            </div>

            <!-- tell() -->
            <div class="demo-card" id="tell">
                <h3>tell()</h3>
                <p class="desc">Display informational message, returns promise</p>
                <pre><code>await tell('Welcome!', 'Info');</code></pre>
                <div class="demo-area">
                    <button onclick="tell('Welcome!', 'This is an informational message.')">tell()</button>
                </div>
            </div>

            <!-- consent() -->
            <div class="demo-card" id="consent">
                <h3>consent()</h3>
                <p class="desc">Get yes/no confirmation, returns promise</p>
                <pre><code>const ok = await consent('Delete?');</code></pre>
                <div class="demo-area">
                    <button onclick="consentDemo()">consent()</button>
                </div>
            </div>

            <!-- snippet() -->
            <div class="demo-card" id="snippet">
                <h3>snippet()</h3>
                <p class="desc">Show code snippet with copy button</p>
                <pre><code>await snippet('Install', code, 'Copy');</code></pre>
                <div class="demo-area">
                    <button onclick="hyperclay.snippet('Install', 'npm install hyperclayjs', 'Copy to terminal')">snippet()</button>
                </div>
            </div>

            <!-- toast() -->
            <div class="demo-card" id="toast">
                <h3>toast()</h3>
                <p class="desc">Show notification messages</p>
                <pre><code>toast('Saved!', 'success');</code></pre>
                <div class="demo-area">
                    <button onclick="toast('Saved successfully!', 'success')">Success</button>
                    <button onclick="toast('Something went wrong', 'error')">Error</button>
                </div>
            </div>

            <!-- ========== SECTION 10: FORM HELPERS ========== -->
            <div class="category-label">Form Helpers</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">What native forms are missing: auto-growing textareas and serialization that handles nested objects and arrays.</p>

            <!-- getDataFromForm -->
            <div class="demo-card" id="form-data">
                <h3>getDataFromForm()</h3>
                <p class="desc">Serialize form to object</p>
                <pre><code>const data = getDataFromForm(form);</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <form id="demo-form" onsubmit="return serializeForm(event)">
                        <input name="title" value="Hyperclay" style="width: 100%; margin-bottom: 0.25rem;">
                        <div class="flex-row">
                            <select name="type">
                                <option>Library</option>
                                <option>Framework</option>
                            </select>
                            <label style="font-size: 0.7rem;"><input type="checkbox" name="flags" value="demo" checked> demo</label>
                        </div>
                        <button type="submit" style="margin-top: 0.5rem; border-color: #006B4D; color: #006B4D; background: #E6F5F0;" onmouseover="this.style.background='#D0EBE3'" onmouseout="this.style.background='#E6F5F0'">Serialize</button>
                    </form>
                    <span class="output" id="form-output" style="margin-top: 0.5rem;">Click serialize</span>
                </div>
            </div>

            <!-- autosize -->
            <div class="demo-card" id="autosize">
                <h3>[autosize]</h3>
                <p class="desc">Textarea grows with content</p>
                <pre><code>&lt;textarea autosize&gt;&lt;/textarea&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <textarea autosize placeholder="Type to grow..." style="width: 100%;" oninput="document.getElementById('autosize-log').textContent = 'Textarea autogrew'"></textarea>
                    <span class="output" id="autosize-log">Press Enter to grow</span>
                </div>
            </div>

            <!-- prevent-enter -->
            <div class="demo-card" id="prevent-enter">
                <h3>[prevent-enter]</h3>
                <p class="desc">Prevent Enter key, useful for inline editing with contenteditable elements</p>
                <pre><code>&lt;span contenteditable prevent-enter&gt;</code></pre>
                <div class="demo-area">
                    <span class="mini-editor" contenteditable prevent-enter style="width: 100%;">No newlines here - Enter does nothing</span>
                </div>
            </div>

            <!-- ========== SECTION 11: COMMUNICATION ========== -->
            <div class="category-label">Communication</div>
            <p class="desc" style="flex: 1 1 100%; margin-top: 0.5rem; font-size: 0.85rem;">Send form data and upload files to Hyperclay servers with one function call.</p>

            <!-- sendMessage -->
            <div class="demo-card" id="send-message">
                <h3>sendMessage()</h3>
                <p class="desc">Submit form data to /message endpoint</p>
                <pre><code>await sendMessage(event, 'Sent!');</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <form id="message-form" onsubmit="return sendMessageDemo(event)">
                        <input name="subject" placeholder="Subject" style="width: 100%; margin-bottom: 0.25rem;">
                        <button type="submit">Send message</button>
                    </form>
                    <span class="output" id="send-log">Submit to test</span>
                </div>
            </div>

            <!-- uploadFile -->
            <div class="demo-card" id="file-upload">
                <h3>uploadFile()</h3>
                <p class="desc">Upload file with progress toasts, copies URL to clipboard</p>
                <pre><code>&lt;input type="file" onchange="uploadFile(event)"&gt;</code></pre>
                <div class="demo-area" style="flex-direction: column; align-items: stretch;">
                    <input type="file" id="upload-input" onchange="uploadDemo(event)">
                    <span class="output" id="upload-log">Select a file</span>
                </div>
            </div>

        </div>

        <footer style="margin-top: 3rem; padding: 2rem; border: 2px solid #E85D04; background: #FEF3E6; text-align: center;">
            <p style="font-size: 1rem; color: #E85D04; margin-bottom: 0.5rem;"><strong>Build your own apps with HyperclayJS</strong></p>
            <p style="font-size: 0.85rem; color: var(--gray); margin-bottom: 1rem;">Make your HTML files into apps</p>
            <a href="https://hyperclay.com" style="display: inline-block; font-weight: bold; color: white; background: #E85D04; padding: 0.6rem 1.5rem; text-decoration: none;">Use HyperclayJS &rarr;</a>
        </footer>

        <footer style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #ddd; text-align: center;">
            <p style="font-size: 0.85rem; color: var(--gray);">HyperclayJS is part of <a href="https://hyperclay.com" style="color: var(--gray);">Hyperclay</a></p>
        </footer>
    </div>

    <script>
        window.hyperclay = window.hyperclay || {};
        window.hyperclay.testMode = true;

        // Mock fetch for demos
        const originalFetch = window.fetch.bind(window);
        window.fetch = async (resource, init = {}) => {
            const url = typeof resource === 'string' ? resource : resource?.url;
            // Mock save endpoint
            if (url?.startsWith('/save/')) {
                await new Promise(r => setTimeout(r, 300));
                return new Response(JSON.stringify({ msg: 'Saved (demo)', msgType: 'success' }), {
                    status: 200, headers: { 'Content-Type': 'application/json' }
                });
            }
            return originalFetch(resource, init);
        };
    </script>
    <script type="module">
        await import('./dist/hyperclay.js?preset=everything&exclude=autosave,save-toast,edit-mode');

        // ========== HELPER FUNCTIONS ==========

        window.randomColor = () => {
            const colors = ['#3E43EF', '#10B981', '#F59E0B', '#DC2626', '#8B5CF6', '#EC4899'];
            return colors[Math.floor(Math.random() * colors.length)];
        };

        // ========== SAVE DEMOS ==========

        window.testSavePage = () => {
            const log = document.getElementById('save-page-log');
            log.textContent = 'Saving...';
            hyperclay.savePage?.(({ msgType, msg }) => {
                log.textContent = `${msgType}: ${msg}`;
            });
        };

        window.dispatchSaveEvent = (type) => {
            const eventName = type === 'saved' ? 'hyperclay:save-saved' : 'hyperclay:save-error';
            document.dispatchEvent(new CustomEvent(eventName, { detail: { msg: `Demo ${type}`, status: type } }));
            // Also show toast since save-toast module is excluded
            toast(type === 'saved' ? 'Page saved' : 'Save failed', type === 'saved' ? 'success' : 'error');
        };

        // Save system - update savestatus on edit
        document.getElementById('save-editor')?.addEventListener('input', () => {
            document.documentElement.setAttribute('savestatus', 'dirty');
            document.getElementById('save-system-log').textContent = 'savestatus: dirty';
        });

        // Autosave demo
        let autosavePending = false;
        document.getElementById('autosave-editor')?.addEventListener('input', () => {
            autosavePending = true;
            document.getElementById('autosave-log').textContent = 'Change detected...';
            // Simulate autosave after delay
            setTimeout(() => {
                if (autosavePending) {
                    autosavePending = false;
                    document.getElementById('autosave-log').textContent = `Auto-saved @ ${new Date().toLocaleTimeString()}`;
                }
            }, 2000);
        });

        // ========== EDIT MODE DEMOS ==========

        window.setEditMode = (isEdit) => {
            document.documentElement.setAttribute('editmode', isEdit ? 'true' : 'false');
            document.getElementById('edit-mode-status').textContent = `editmode: ${isEdit}`;

            // Toggle all edit-mode-* elements using module functions
            if (isEdit) {
                hyperclay.enableContentEditable?.();
                hyperclay.enableAdminInputs?.();
                hyperclay.enableOnClick?.();
                hyperclay.enableAdminResources?.();
            } else {
                hyperclay.disableContentEditable?.();
                hyperclay.disableAdminInputs?.();
                hyperclay.disableOnClick?.();
                hyperclay.disableAdminResources?.();
            }
        };

        window.toggleEditModeDemo = () => {
            const current = document.documentElement.getAttribute('editmode');
            setEditMode(current !== 'true');
        };

        // ========== DOM HELPER DEMOS ==========

        window.execDeleteDemo = (container) => {
            consent('Delete this item?', () => {
                container.remove();
                document.getElementById('exec-log').textContent = 'Item deleted!';
            });
        };

        // ========== EVENT ATTRIBUTE DEMOS ==========

        window.cloneItem = () => {
            const template = document.getElementById('clone-template');
            const clone = template.cloneNode(true);
            clone.style.display = 'inline-block';
            clone.id = '';
            document.getElementById('clone-area').appendChild(clone);
        };

        // ========== MUTATION DEMOS ==========

        let globalMutCount = 0;
        window.addGlobalMutationItem = () => {
            globalMutCount++;
            const li = document.createElement('li');
            li.className = 'badge';
            li.textContent = `#${globalMutCount}`;
            document.getElementById('globalmutation-list').appendChild(li);
        };

        let mutBatch = 0;
        if (window.Mutation?.onAddElement) {
            Mutation.onAddElement({ selectorFilter: '.mut-item' }, changes => {
                document.getElementById('mutation-log').textContent = `Added ${changes.length} element(s)`;
            });
        }
        window.addMutationBlocks = () => {
            mutBatch++;
            const container = document.getElementById('mutation-items');
            container.innerHTML = '';
            for (let i = 1; i <= 8; i++) {
                const block = document.createElement('span');
                block.className = 'badge mut-item';
                block.textContent = `${mutBatch}.${i}`;
                container.appendChild(block);
            }
        };

        // ========== UTILITY DEMOS ==========

        let morphIndex = 0;
        window.morphDemo = () => {
            morphIndex = (morphIndex + 1) % 26;
            const letter = String.fromCharCode(65 + morphIndex);
            const target = document.getElementById('morph-target');
            hyperclay.Idiomorph?.morph(target, `<div class="morph-box" id="morph-target">${letter}</div>`);
        };

        // Query display
        const queryOut = document.getElementById('query-out');
        const params = Object.fromEntries(new URLSearchParams(location.search));
        queryOut.textContent = Object.keys(params).length ? JSON.stringify(params) : '(no params)';

        // ========== ALL() DEMOS ==========

        window.filterByCategory = (category) => {
            document.querySelectorAll('[filter-card]').forEach(c => {
                c.classList.toggle('muted', category && c.getAttribute('category') !== category);
            });
        };

        // ========== UI COMPONENT DEMOS ==========

        const CLOSE_BUTTON_SVG = `<svg viewBox="0 0 134 134" fill="none" xmlns="http://www.w3.org/2000/svg"><path class="micromodal__close-bg" d="M132 132.5 1 1.5h131v131Z" /><path class="micromodal__close-x" fill-rule="evenodd" clip-rule="evenodd" d="M0 0h3v1.5h1.5V3H6v1.5h1.5V6H9v1.5h1.5V9H12v1.5h1.5V12H15v1.5h1.5V15H18v1.5h1.5V18H21v1.5h1.5V21H24v1.5h1.5V24H27v1.5h1.5V27H30v1.5h1.5V30H33v1.5h1.5V33H36v1.5h1.5V36H39v1.5h1.5V39H42v1.5h1.5V42H45v1.5h1.5V45H48v1.5h1.5V48H51v1.5h1.5V51H54v1.5h1.5V54H57v1.5h1.5V57H60v1.5h1.5V60H63v1.5h1.5V63H66v1.5h1.5V66H69v1.5h1.5V69H72v1.5h1.5V72H75v1.5h1.5V75H78v1.5h1.5V78H81v1.5h1.5V81H84v1.5h1.5V84H87v1.5h1.5V87H90v1.5h1.5V90H93v1.5h1.5V93H96v1.5h1.5V96H99v1.5h1.5V99h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v1.5h1.5v3h-3V132H129v-1.5h-1.5V129H126v-1.5h-1.5V126H123v-1.5h-1.5V123H120v-1.5h-1.5V120H117v-1.5h-1.5V117H114v-1.5h-1.5V114H111v-1.5h-1.5V111H108v-1.5h-1.5V108H105v-1.5h-1.5V105H102v-1.5h-1.5V102H99v-1.5h-1.5V99H96v-1.5h-1.5V96H93v-1.5h-1.5V93H90v-1.5h-1.5V90H87v-1.5h-1.5V87H84v-1.5h-1.5V84H81v-1.5h-1.5V81H78v-1.5h-1.5V78H75v-1.5h-1.5V75H72v-1.5h-1.5V72H69v-1.5h-1.5V69H66v-1.5h-1.5V66H63v-1.5h-1.5V63H60v-1.5h-1.5V60H57v-1.5h-1.5V57H54v-1.5h-1.5V54H51v-1.5h-1.5V51H48v-1.5h-1.5V48H45v-1.5h-1.5V45H42v-1.5h-1.5V42H39v-1.5h-1.5V39H36v-1.5h-1.5V36H33v-1.5h-1.5V33H30v-1.5h-1.5V30H27v-1.5h-1.5V27H24v-1.5h-1.5V24H21v-1.5h-1.5V21H18v-1.5h-1.5V18H15v-1.5h-1.5V15H12v-1.5h-1.5V12H9v-1.5H7.5V9H6V7.5H4.5V6H3V4.5H1.5V3H0V0ZM108.8 22h5.2v5.1h-2.6v2.6H109v2.6h-2.6v2.6h-2.6v2.5h-2.6v5.2h2.6V45h2.6v2.6h2.6v2.6h2.5v2.6h2.6V58h-5.1v-2.6h-2.6V53h-2.6v-2.6h-2.6v-2.6h-2.5v-2.6h-5.2v2.6H91v2.6h-2.6v2.6h-2.6v2.5h-2.6V58H78v-5.1h2.6v-2.6H83v-2.6h2.6v-2.6h2.6v-2.5h2.6v-5.2h-2.6V35h-2.6v-2.6h-2.6v-2.6h-2.5v-2.6H78V22h5.2v2.6h2.5V27h2.6v2.6h2.6v2.6h2.5v2.6h5.2v-2.6h2.5v-2.6h2.6v-2.6h2.6v-2.5h2.5V22Z" /></svg>`;

        window.openCustomModal = () => {
            themodal.html = `
                <div style="text-align: center; padding: 1rem;">
                    <h2 style="margin-bottom: 0.5rem;">Custom Modal</h2>
                    <p style="color: #666;">This is theModal in action!</p>
                </div>
            `;
            themodal.closeHtml = CLOSE_BUTTON_SVG;
            themodal.yes = 'Got it';
            themodal.onYes(() => true);
            themodal.open();
        };

        window.askDemo = async () => {
            const name = await new Promise(resolve => {
                ask('What is your name?', resolve);
            });
            if (name) toast(`Hello, ${name}!`, 'success');
        };

        window.consentDemo = async () => {
            consent('Are you sure?', () => {
                toast('Confirmed!', 'success');
            });
        };

        // ========== FORM HELPER DEMOS ==========

        window.updatePersistDisplay = () => {
            const input = document.getElementById('persist-input');
            const select = document.getElementById('persist-select');
            const radio = document.querySelector('input[name="persist-radio"]:checked');
            setTimeout(() => {
                const vals = [];
                if (input?.getAttribute('value')) vals.push(`input: "${input.getAttribute('value')}"`);
                if (radio) vals.push(`radio: ${radio.value}`);
                if (select) vals.push(`select: ${select.value}`);
                document.getElementById('persist-log').textContent = vals.length ? vals.join(', ') : 'Values will appear here';
            }, 50);
        };

        window.serializeForm = (event) => {
            event.preventDefault();
            const form = document.getElementById('demo-form');
            const data = hyperclay.getDataFromForm?.(form) || {};
            document.getElementById('form-output').textContent = JSON.stringify(data);
            return false;
        };

        // ========== COMMUNICATION DEMOS ==========

        window.sendMessageDemo = (event) => {
            event.preventDefault();
            document.getElementById('send-log').textContent = 'Sending...';
            setTimeout(() => {
                document.getElementById('send-log').textContent = 'Message sent (demo)';
                document.getElementById('message-form').reset();
            }, 400);
            return false;
        };

        window.uploadDemo = (event) => {
            const input = event.target;
            const filename = input?.files?.[0]?.name || 'file.txt';
            document.getElementById('upload-log').textContent = 'Uploading...';
            setTimeout(() => {
                document.getElementById('upload-log').textContent = `https://example.com/${filename}`;
                if (input) input.value = '';
            }, 400);
        };

        // ========== INITIAL STATE ==========
        document.getElementById('edit-mode-status').textContent = `editmode: ${document.documentElement.getAttribute('editmode')}`;
    </script>
</body>
</html>
